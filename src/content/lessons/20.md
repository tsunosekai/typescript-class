---
title: "画面を変化させよう（state）"
lesson: 20
goal: "useStateで画面を動的に変化させられるようになる"
time: "約40分"
checklist:
  - "useState の使い方がわかった"
  - "state が変わると画面が更新されることがわかった"
  - "React でカウンターを作れた"
---


<details>
<summary>💡 AIに質問するときはここをクリック</summary>

ChatGPTやClaudeなどのAIに質問するときは、以下をコピーして最初に貼り付けてね！

```
【TypeScript講座 学習状況】
現在地: 第20回「画面を変化させよう（state）」

■ 学習済みの内容:
- VSCode、ターミナル、Node.js/TypeScript環境
- HTML/CSSの基本、Flexbox
- TypeScriptの基礎（変数、型、if文、for文、関数、配列、オブジェクト）
- DOM操作、イベント処理
- React:
  - Viteでプロジェクト作成（npm create vite）
  - コンポーネント（関数コンポーネント、コンポーネントツリー）
  - JSX（HTMLに似た書き方）
  - props（親→子へのデータ渡し）
- 【作品①】自己紹介ページ
- 【作品②】じゃんけんゲーム
- 【作品③】クイズゲーム

■ まだ習っていない内容:
条件付きレンダリング、リスト表示（map）など

上記の学習状況を踏まえて、初心者にも分かるように答えてください。
まだ習っていない概念は使わないでください。

【質問】
ここに質問を書いてね
```

</details>

> **この回で学ぶこと**
> - なぜstateが必要なのか
> - useStateの使い方
> - stateが変わると画面が自動更新される仕組み
> - stateの注意点
> - 【実践】カウンターをReactで作る

---

## はじめに

前回、Reactの基本とJSXを学びました。

今回は「**state（ステート）**」を学びます。

stateを使うと、**画面を動的に変化**させることができます！

---

## なぜstateが必要？

普通の変数だと、値を変えても画面は更新されません：

```tsx
function App() {
    let count = 0;  // 普通の変数

    const handleClick = () => {
        count = count + 1;  // 値は変わるけど…
        console.log(count);  // ログには出るけど…
    };

    return (
        <div>
            <p>カウント: {count}</p>  {/* 画面は0のまま！ */}
            <button onClick={handleClick}>増やす</button>
        </div>
    );
}
```

**state** を使うと、値が変わった時に自動で画面が更新されます！

---

## STEP 1: プロジェクトを開く

### 1-1. VSCodeを起動する

デスクトップのVSCodeアイコンをダブルクリックして、VSCodeを起動します。

### 1-2. プロジェクトフォルダを開く

**「ファイル」→「フォルダーを開く」** から、デスクトップの `react-shindan` フォルダを開きます。

### 1-3. ターミナルを開く

**「ターミナル」→「新しいターミナル」** をクリック

### 1-4. 開発サーバーを起動

```
npm run dev
```

ブラウザで `http://localhost:5173/` を開きます。

---

## STEP 2: useStateを使ってみよう

### 2-1. 基本の形

```tsx
import { useState } from "react";

function App() {
    const [count, setCount] = useState(0);
    //    ↑値    ↑更新関数         ↑初期値

    return (
        <div>
            <p>カウント: {count}</p>
        </div>
    );
}
```

### 2-2. 分解して理解する

```tsx
const [count, setCount] = useState(0);
```

- `useState(0)` → 初期値0でstateを作成
- `count` → 現在の値を読み取る変数
- `setCount` → 値を更新する関数

> **`[count, setCount]` って何？（分割代入）**
> この `[a, b] = ...` という書き方は「**分割代入**」と呼ばれる構文です。
> 配列の中身を取り出して、別々の変数に入れています。
>
> ```tsx
> // useStateは [値, 更新関数] の配列を返す
> const result = useState(0);  // result = [0, 更新関数]
>
> // 分割代入で取り出す（↓これと同じ意味）
> const count = result[0];     // 0
> const setCount = result[1];  // 更新関数
>
> // 短く書くと
> const [count, setCount] = useState(0);
> ```
>
> 今は「こう書くと2つの変数が取り出せる」と覚えておけばOK！

---

## STEP 3: カウンターを作ってみよう

`src/App.tsx` を書き換えます：

```tsx
import { useState } from "react";

function App() {
    const [count, setCount] = useState(0);

    const increment = () => {
        setCount(count + 1);
    };

    const decrement = () => {
        setCount(count - 1);
    };

    const reset = () => {
        setCount(0);
    };

    return (
        <div style={{ padding: "20px", textAlign: "center" }}>
            <h1>カウンター</h1>
            <p style={{ fontSize: "48px", fontWeight: "bold" }}>{count}</p>
            <div>
                <button onClick={decrement} style={buttonStyle}>−</button>
                <button onClick={reset} style={buttonStyle}>リセット</button>
                <button onClick={increment} style={buttonStyle}>＋</button>
            </div>
        </div>
    );
}

const buttonStyle = {
    padding: "10px 20px",
    fontSize: "20px",
    margin: "5px",
    cursor: "pointer"
};

export default App;
```

**`Ctrl + S`** で保存して、ブラウザで試してみましょう！

![screenshot: Reactカウンター](./images/react-counter.svg)

ボタンを押すと、カウントが増減します！

---

## STEP 4: stateの仕組みを理解する

### なぜ画面が更新される？

1. ボタンをクリック
2. `setCount(count + 1)` が実行される
3. Reactが「stateが変わった！」と検知
4. コンポーネントが**再レンダリング**（再描画）される
5. 新しい値で画面が表示される

> **レンダリングとは？**
> 「画面を描画する」という意味です。「再レンダリング」は、画面を描き直すことです。

### 重要: setCountを使わないと更新されない

```tsx
// ❌ これでは画面が更新されない
count = count + 1;

// ✅ setCountを使う
setCount(count + 1);
```

---

## STEP 5: 複数のstateを使う

stateは何個でも使えます：

```tsx
import { useState } from "react";

function App() {
    const [name, setName] = useState("");
    const [age, setAge] = useState(0);
    const [isStudent, setIsStudent] = useState(false);

    return (
        <div style={{ padding: "20px" }}>
            <h1>プロフィール入力</h1>

            <div style={{ marginBottom: "10px" }}>
                <label>名前: </label>
                <input
                    type="text"
                    value={name}
                    onChange={(e) => setName(e.target.value)}
                />
            </div>

            <div style={{ marginBottom: "10px" }}>
                <label>年齢: </label>
                <input
                    type="number"
                    value={age}
                    onChange={(e) => setAge(Number(e.target.value))}
                />
            </div>

            <div style={{ marginBottom: "10px" }}>
                <label>
                    <input
                        type="checkbox"
                        checked={isStudent}
                        onChange={(e) => setIsStudent(e.target.checked)}
                    />
                    学生です
                </label>
            </div>

            <hr />

            <h2>入力内容</h2>
            <p>名前: {name || "未入力"}</p>
            <p>年齢: {age}歳</p>
            <p>学生: {isStudent ? "はい" : "いいえ"}</p>
        </div>
    );
}

export default App;
```

**`Ctrl + S`** で保存して試してみましょう。

入力すると、リアルタイムで下の表示が変わります！

![screenshot: プロフィール入力フォーム](./images/react-form.svg)

---

## STEP 6: stateの注意点

### 注意①: stateを直接変更しない

```tsx
// ❌ ダメな例
count = 10;

// ✅ 正しい例
setCount(10);
```

### 注意②: 配列やオブジェクトは新しく作る

```tsx
const [items, setItems] = useState(["A", "B", "C"]);

// ❌ ダメな例（元の配列を変更）
items.push("D");
setItems(items);

// ✅ 正しい例（新しい配列を作る）
setItems([...items, "D"]);
```

### 注意③: 前の値を使う時は関数形式

```tsx
// ⚠️ 連続して呼ぶと問題が起きることがある
setCount(count + 1);
setCount(count + 1);

// ✅ 関数形式なら安全
setCount((prev) => prev + 1);
setCount((prev) => prev + 1);
```

---

## STEP 7: 実践 - もう少し凝ったカウンター

```tsx
import { useState } from "react";

function App() {
    const [count, setCount] = useState(0);

    // カウントに応じた色
    const getColor = () => {
        if (count > 0) return "#4CAF50";
        if (count < 0) return "#f44336";
        return "#333";
    };

    return (
        <div style={{
            minHeight: "100vh",
            display: "flex",
            flexDirection: "column",
            justifyContent: "center",
            alignItems: "center",
            backgroundColor: "#f0f0f0"
        }}>
            <div style={{
                backgroundColor: "white",
                padding: "40px",
                borderRadius: "16px",
                boxShadow: "0 4px 6px rgba(0,0,0,0.1)",
                textAlign: "center"
            }}>
                <h1>カウンター</h1>

                <p style={{
                    fontSize: "72px",
                    fontWeight: "bold",
                    color: getColor(),
                    margin: "20px 0"
                }}>
                    {count}
                </p>

                <div>
                    <button
                        onClick={() => setCount((c) => c - 1)}
                        style={{
                            ...buttonStyle,
                            backgroundColor: "#f44336",
                            color: "white"
                        }}
                    >
                        −1
                    </button>

                    <button
                        onClick={() => setCount(0)}
                        style={{
                            ...buttonStyle,
                            backgroundColor: "#9e9e9e",
                            color: "white"
                        }}
                    >
                        リセット
                    </button>

                    <button
                        onClick={() => setCount((c) => c + 1)}
                        style={{
                            ...buttonStyle,
                            backgroundColor: "#4CAF50",
                            color: "white"
                        }}
                    >
                        +1
                    </button>
                </div>

                <p style={{ marginTop: "20px", color: "#666" }}>
                    {count > 0 && "プラスです！ 🎉"}
                    {count < 0 && "マイナスです... 😢"}
                    {count === 0 && "ゼロです"}
                </p>
            </div>
        </div>
    );
}

const buttonStyle = {
    padding: "15px 25px",
    fontSize: "20px",
    margin: "5px",
    border: "none",
    borderRadius: "8px",
    cursor: "pointer"
};

export default App;
```

**`Ctrl + S`** で保存して確認！

![screenshot: 凝ったカウンター](./images/react-counter-fancy.svg)

---

## まとめ

この回でやったこと：

- ✅ stateとは「画面を更新できる特別な変数」
- ✅ `useState` でstateを作成
- ✅ `setXxx` で値を更新すると画面が再レンダリング
- ✅ 複数のstateを組み合わせられる
- ✅ stateは直接変更せず、set関数を使う

---

## 次回予告

次回は「**条件によって表示を変えよう**」です。

条件によって表示を切り替えたり、配列をリスト表示したりする方法を学びます！

---

## 練習問題（やってみよう）

1. カウンターに「+10」「-10」ボタンを追加してみよう
2. カウントが10以上で「すごい！」、-10以下で「やばい！」と表示してみよう
3. 入力フォームに「クリア」ボタンを追加してみよう

保存（`Ctrl + S`）すると自動で更新されます！

---

## 困ったときは（よくあるエラーと対処法）

### 画面が更新されない

**原因①：`setXxx` を使っていない**
```typescript
// ❌ これでは画面が更新されない
count = count + 1;

// ✅ 必ず setXxx を使う
setCount(count + 1);
```

**原因②：stateを直接変更している（配列・オブジェクトの場合）**
```typescript
// ❌ 配列を直接変更（画面が更新されない）
items.push("新しいアイテム");
setItems(items);

// ✅ 新しい配列を作る
setItems([...items, "新しいアイテム"]);
```

**原因③：開発サーバーが止まっている**
→ ターミナルを確認して、`npm run dev` が動いているか確認
→ 止まっていたら再度 `npm run dev` を実行

---

### useStateでエラーが出る

**エラー例①：useState is not defined**
```
ReferenceError: useState is not defined
```
→ インポートを忘れています
```typescript
// ✅ ファイルの先頭に追加
import { useState } from "react";
```

**エラー例②：Hooks can only be called inside a function component**
```
Invalid hook call. Hooks can only be called inside of the body of a function component.
```
→ `useState` はコンポーネント関数の中でしか使えません
```typescript
// ❌ コンポーネントの外で使っている
const [count, setCount] = useState(0);

function App() {
    return <div>{count}</div>;
}

// ✅ コンポーネントの中で使う
function App() {
    const [count, setCount] = useState(0);
    return <div>{count}</div>;
}
```

**エラー例③：Too many re-renders**
```
Error: Too many re-renders. React limits the number of renders to prevent an infinite loop.
```
→ レンダリング中に `setXxx` を直接呼んでいます
```typescript
// ❌ 無限ループになる
function App() {
    const [count, setCount] = useState(0);
    setCount(count + 1);  // レンダリングのたびに呼ばれる！
    return <div>{count}</div>;
}

// ✅ イベントの中で呼ぶ
function App() {
    const [count, setCount] = useState(0);
    return (
        <button onClick={() => setCount(count + 1)}>
            増やす
        </button>
    );
}
```

---

### ボタンをクリックしても反応しない

**原因①：`onClick` の書き方が間違っている**
```typescript
// ❌ 関数を実行してしまっている（カッコあり）
<button onClick={handleClick()}>

// ✅ 関数を渡す（カッコなし）
<button onClick={handleClick}>

// ✅ アロー関数で書く場合
<button onClick={() => handleClick()}>
```

**原因②：関数名のスペルミス**
→ 定義した関数名と使っている関数名が一致しているか確認

---

### 入力フォームの値が変わらない

**原因①：`onChange` を設定していない**
```typescript
// ❌ 入力しても反映されない
<input type="text" value={name} />

// ✅ onChange で state を更新
<input
    type="text"
    value={name}
    onChange={(e) => setName(e.target.value)}
/>
```

**原因②：`value` の型が合っていない（numberの場合）**
```typescript
// ✅ Number() で変換が必要
<input
    type="number"
    value={age}
    onChange={(e) => setAge(Number(e.target.value))}
/>
```

---

### よくある間違い

**間違い①：state の初期値の型が違う**
```typescript
// ⚠️ 初期値が 0 だと number 型になる
const [text, setText] = useState(0);
setText("Hello");  // エラー！

// ✅ 文字列を入れるなら初期値も文字列
const [text, setText] = useState("");
setText("Hello");  // OK
```

**間違い②：分割代入を忘れる**
```typescript
// ❌ これだと配列のまま
const count = useState(0);

// ✅ 分割代入で取り出す
const [count, setCount] = useState(0);
```

---

### デバッグのコツ

1. **console.log で state の値を確認**
```typescript
console.log("count:", count);
```

2. **React Developer Tools を使う**
→ ブラウザの拡張機能「React Developer Tools」をインストールすると、
   開発者ツールで state の値をリアルタイムで確認できます

3. **エラーメッセージをよく読む**
→ Reactのエラーメッセージは親切です。英語でも、翻訳ツールを使って読んでみましょう
